<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>参与率统计分析</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/layui-src/dist/css/layui.css" media="all">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <style>
        body {
            background-color: #f5f7fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .statistics-container {
            margin: 30px;
            padding: 25px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .page-title {
            color: #165DFF;
            font-weight: 600;
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f2f3f5;
            position: relative;
        }
        
        .page-title i {
            margin-right: 8px;
        }
        
        .page-title::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -1px;
            width: 60px;
            height: 3px;
            background-color: #165DFF;
            border-radius: 3px;
        }
        
        /* 筛选区域样式 */
        .filter-panel {
            background-color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .layui-form-item {
            margin-bottom: 0;
        }
        
        .layui-form-label {
            width: 90px;
            padding: 9px 15px;
            font-weight: 500;
        }
        
        .layui-input-block {
            margin-left: 120px;
        }
        
        /* 图表控制区 */
        .chart-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .chart-type {
            display: flex;
            gap: 10px;
        }
        
        /* 按钮样式 */
        .layui-btn {
            height: 36px;
            line-height: 36px;
            padding: 0 18px;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .layui-btn-primary {
            background-color: #f2f3f5;
            color: #4E5969;
            border-color: #e5e6eb;
        }
        
        .layui-btn-primary:hover {
            background-color: #e5e6eb;
            color: #1D2129;
            border-color: #d9d9d9;
        }
        
        .layui-btn:not(.layui-btn-primary) {
            background-color: #165DFF;
            border-color: #165DFF;
        }
        
        .layui-btn:not(.layui-btn-primary):hover {
            background-color: #0E42D2;
            border-color: #0E42D2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(22, 93, 255, 0.2);
        }
        
        /* 图表容器 */
        .chart-container {
            height: 400px;
            position: relative;
            margin-bottom: 30px;
            border: 1px solid #f2f3f5;
            border-radius: 8px;
            padding: 15px;
        }
        
        /* 数据卡片区域 */
        .stats-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            flex: 1;
            min-width: 250px;
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
        }
        
        .stat-title {
            color: #6B7280;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-value {
            color: #165DFF;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .stat-trend {
            display: flex;
            align-items: center;
            font-size: 13px;
        }
        
        .trend-up {
            color: #00B42A;
        }
        
        .trend-down {
            color: #F53F3F;
        }
        
        .stat-trend i {
            margin-right: 5px;
            font-size: 14px;
        }
        
        /* 响应式调整 */
        @media (max-width: 992px) {
            .statistics-container {
                margin: 15px;
                padding: 15px;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .chart-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .layui-input-block {
                margin-left: 0;
                width: 100%;
            }
            
            .layui-form-label {
                width: 100%;
                display: block;
                margin-bottom: 8px;
            }
            
            .stats-cards {
                flex-direction: column;
            }
            
            .stat-card {
                min-width: auto;
            }
            
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
<div class="statistics-container">
    <h2 class="page-title"><i class="fa fa-line-chart"></i>参与率统计分析</h2>
    
    <!-- 筛选条件区域 -->
    <div class="filter-panel">
        <form class="layui-form" lay-filter="statFilter">
            <div class="filter-group">
                <div class="layui-form-item">
                    <label class="layui-form-label">统计维度</label>
                    <div class="layui-input-block">
                        <select name="dimension" lay-filter="dimension">
                            <option value="class" selected>班级</option>
                            <option value="grade">年级</option>
                            <option value="major">专业</option>
                        </select>
                    </div>
                </div>
                
                <div class="layui-form-item">
                    <label class="layui-form-label">时间范围</label>
                    <div class="layui-input-block">
                        <select name="timeRange" lay-filter="timeRange">
                            <option value="week">近7天</option>
                            <option value="month" selected>近30天</option>
                            <option value="quarter">近3个月</option>
                            <option value="semester">本学期</option>
                            <option value="year">本年度</option>
                        </select>
                    </div>
                </div>
                
                <div class="layui-form-item" id="gradeFilter">
                    <label class="layui-form-label">年级</label>
                    <div class="layui-input-block">
                        <select name="grade">
                            <option value="">全部年级</option>
                            <option value="1">高一</option>
                            <option value="2" selected>高二</option>
                            <option value="3">高三</option>
                        </select>
                    </div>
                </div>
                
                <div class="layui-form-item" id="majorFilter" style="display: none;">
                    <label class="layui-form-label">专业</label>
                    <div class="layui-input-block">
                        <select name="major">
                            <option value="">全部专业</option>
                            <option value="软件工程">软件工程</option>
                            <option value="计算机科学与技术">计算机科学与技术</option>
                            <option value="人工智能">人工智能</option>
                        </select>
                    </div>
                </div>
                
                <div class="layui-form-item">
                    <button class="layui-btn" lay-submit lay-filter="refreshStat">
                        <i class="fa fa-refresh mr-1"></i>刷新数据
                    </button>
                    <button type="button" class="layui-btn layui-btn-primary" id="exportBtn">
                        <i class="fa fa-download mr-1"></i>导出数据
                    </button>
                </div>
            </div>
        </form>
    </div>
    
    <!-- 图表控制和图表区域 -->
    <div class="chart-controls">
        <div class="chart-type">
            <button class="layui-btn" data-type="bar">
                <i class="fa fa-bar-chart mr-1"></i>柱状图
            </button>
            <button class="layui-btn layui-btn-primary" data-type="line">
                <i class="fa fa-line-chart mr-1"></i>折线图
            </button>
            <button class="layui-btn layui-btn-primary" data-type="pie">
                <i class="fa fa-pie-chart mr-1"></i>饼图
            </button>
        </div>
        
        <div>
            <button class="layui-btn layui-btn-primary" id="compareBtn">
                <i class="fa fa-exchange mr-1"></i>环比分析
            </button>
        </div>
    </div>
    
    <!-- 图表容器 -->
    <div class="chart-container">
        <canvas id="participationChart"></canvas>
    </div>
    
    <!-- 数据统计卡片 -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-title">平均参与率</div>
            <div class="stat-value">87.6%</div>
            <div class="stat-trend trend-up">
                <i class="fa fa-arrow-up"></i>
                <span>较上期提升2.3个百分点</span>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-title">最高参与率</div>
            <div class="stat-value">95.2%</div>
            <div class="stat-trend">
                <span>高二3班</span>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-title">最低参与率</div>
            <div class="stat-value">78.3%</div>
            <div class="stat-trend">
                <span>高二1班</span>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-title">参与率达标率</div>
            <div class="stat-value">76.5%</div>
            <div class="stat-trend trend-down">
                <i class="fa fa-arrow-down"></i>
                <span>较上期下降1.2个百分点</span>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/layui-src/dist/layui.js" charset="utf-8"></script>
<script>
    layui.use(['form', 'layer'], function() {
        var form = layui.form;
        var layer = layui.layer;
        var $ = layui.jquery;
        
        // 初始化图表
        var ctx = document.getElementById('participationChart').getContext('2d');
        var chartType = 'bar'; // 默认图表类型
        
        // 图表数据
        var chartData = {
            labels: ['1班', '2班', '3班', '4班', '5班', '6班', '7班', '8班'],
            datasets: [{
                label: '参与率',
                data: [78.3, 85.6, 95.2, 82.1, 88.7, 91.5, 84.3, 89.8],
                backgroundColor: 'rgba(22, 93, 255, 0.7)',
                borderColor: 'rgba(22, 93, 255, 1)',
                borderWidth: 1,
                borderRadius: 6,
                barPercentage: 0.6,
                categoryPercentage: 0.7
            }]
        };
        
        // 图表配置
        var chartConfig = {
            type: chartType,
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            boxWidth: 12,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.7)',
                        padding: 12,
                        cornerRadius: 6,
                        callbacks: {
                            label: function(context) {
                                return `参与率: ${context.raw}%`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                animation: {
                    duration: 1000,
                    easing: 'easeOutQuart'
                }
            }
        };
        
        // 创建图表
        var participationChart = new Chart(ctx, chartConfig);
        
        // 切换图表类型
        $('.chart-type .layui-btn').on('click', function() {
            var type = $(this).attr('data-type');
            
            // 更新按钮状态
            $('.chart-type .layui-btn').removeClass('layui-btn-primary');
            $('.chart-type .layui-btn').addClass('layui-btn-primary');
            $(this).removeClass('layui-btn-primary');
            
            // 更新图表类型
            chartType = type;
            participationChart.config.type = type;
            
            // 根据图表类型调整配置
            if (type === 'pie') {
                // 饼图配置
                participationChart.options.plugins.legend.position = 'right';
                participationChart.options.scales = {}; // 移除坐标轴
            } else {
                // 柱状图/折线图配置
                participationChart.options.plugins.legend.position = 'top';
                participationChart.options.scales = chartConfig.options.scales;
            }
            
            participationChart.update();
        });
        
        // 监听统计维度变化
        form.on('select(dimension)', function(data) {
            var dimension = data.value;
            
            // 显示/隐藏相应的筛选条件
            if (dimension === 'major') {
                $('#gradeFilter').hide();
                $('#majorFilter').show();
            } else if (dimension === 'grade') {
                $('#gradeFilter').show();
                $('#majorFilter').hide();
            } else { // class
                $('#gradeFilter').show();
                $('#majorFilter').hide();
            }
            
            // 模拟数据加载
            refreshChartData();
        });
        
        // 监听时间范围变化
        form.on('select(timeRange)', function() {
            refreshChartData();
        });
        
        // 刷新数据按钮
        form.on('submit(refreshStat)', function() {
            refreshChartData();
            return false;
        });
        
        // 导出数据按钮
        $('#exportBtn').on('click', function() {
            layer.confirm('确定要导出当前统计数据吗？', {
                icon: 3,
                title: '提示'
            }, function(index) {
                layer.close(index);
                layer.load(2);
                
                // 模拟导出操作
                setTimeout(function() {
                    layer.closeAll('loading');
                    layer.msg('数据导出成功', {icon: 1});
                }, 1000);
            });
        });
        
        // 环比分析按钮
        $('#compareBtn').on('click', function() {
            // 切换按钮状态
            $(this).toggleClass('layui-btn-primary');
            
            if (!$(this).hasClass('layui-btn-primary')) {
                // 添加环比数据
                participationChart.data.datasets.push({
                    label: '上期参与率',
                    data: [76.1, 83.2, 92.5, 80.3, 86.4, 89.7, 82.6, 87.5],
                    backgroundColor: 'rgba(153, 153, 153, 0.5)',
                    borderColor: 'rgba(153, 153, 153, 1)',
                    borderWidth: 1,
                    borderRadius: 6,
                    barPercentage: 0.6,
                    categoryPercentage: 0.7
                });
            } else {
                // 移除环比数据
                if (participationChart.data.datasets.length > 1) {
                    participationChart.data.datasets.pop();
                }
            }
            
            participationChart.update();
        });
        
        // 刷新图表数据
        function refreshChartData() {
            var dimension = $('select[name="dimension"]').val();
            var timeRange = $('select[name="timeRange"]').val();
            
            layer.load(2);
            
            // 模拟数据加载
            setTimeout(function() {
                // 根据不同维度更新数据
                if (dimension === 'grade') {
                    participationChart.data.labels = ['高一', '高二', '高三'];
                    participationChart.data.datasets[0].data = [82.5, 87.6, 84.3];
                } else if (dimension === 'major') {
                    participationChart.data.labels = ['软件工程', '计算机科学与技术', '人工智能', '数据科学'];
                    participationChart.data.datasets[0].data = [89.2, 86.5, 91.3, 84.7];
                } else {
                    // 班级维度数据随机波动，模拟真实场景
                    var baseData = [78.3, 85.6, 95.2, 82.1, 88.7, 91.5, 84.3, 89.8];
                    participationChart.data.labels = ['1班', '2班', '3班', '4班', '5班', '6班', '7班', '8班'];
                    participationChart.data.datasets[0].data = baseData.map(value => {
                        // 随机波动±2%
                        return Math.max(60, Math.min(100, value + (Math.random() * 4 - 2))).toFixed(1) * 1;
                    });
                }
                
                // 更新图表
                participationChart.update();
                
                // 关闭加载动画
                layer.closeAll('loading');
                layer.msg('数据已更新', {icon: 1, time: 1000});
            }, 800);
        }
    });
</script>
</body>
</html>
